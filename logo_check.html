<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企業ロゴ確認</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .summary {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background-color: #4a90d9;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        .logo-cell {
            width: 120px;
            text-align: center;
        }
        .logo-cell img {
            max-width: 100px;
            max-height: 60px;
            object-fit: contain;
        }
        .missing {
            background-color: #ffe6e6;
            color: #cc0000;
            font-weight: bold;
        }
        .found {
            background-color: #e6ffe6;
        }
        .status-ok {
            color: #00aa00;
            font-weight: bold;
        }
        .status-missing {
            color: #cc0000;
            font-weight: bold;
        }
        #filter-buttons {
            margin-bottom: 15px;
        }
        #filter-buttons button {
            padding: 8px 16px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #filter-buttons button.active {
            background-color: #4a90d9;
            color: white;
        }
        #filter-buttons button:not(.active) {
            background-color: #ddd;
        }
    </style>
</head>
<body>
    <h1>企業ロゴ確認ページ</h1>
    <div class="summary">
        <p><strong>総企業数:</strong> <span id="total-count">0</span></p>
        <p><strong>ロゴあり:</strong> <span id="found-count" class="status-ok">0</span></p>
        <p><strong>ロゴなし:</strong> <span id="missing-count" class="status-missing">0</span></p>
    </div>
    <div id="filter-buttons">
        <button class="active" onclick="filterRows('all')">すべて表示</button>
        <button onclick="filterRows('missing')">ロゴなしのみ</button>
        <button onclick="filterRows('found')">ロゴありのみ</button>
    </div>
    <table id="logo-table">
        <thead>
            <tr>
                <th>No.</th>
                <th>企業ID</th>
                <th>企業名</th>
                <th>ステータス</th>
                <th class="logo-cell">ロゴ</th>
            </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
    </table>

    <script>
        // CSVデータを読み込んでテーブルを生成
        async function loadData() {
            try {
                const response = await fetch('company_list.csv');
                const csvText = await response.text();
                const rows = parseCSV(csvText);

                const tbody = document.getElementById('table-body');
                let foundCount = 0;
                let missingCount = 0;

                rows.forEach((row, index) => {
                    if (index === 0) return; // ヘッダーをスキップ

                    const companyNameJa = row[0];
                    const companyNameEn = row[1];
                    const logoUrl = row[8];

                    // logo_urlからファイル名を抽出
                    const logoFileName = logoUrl ? logoUrl.split('/').pop().replace('.png', '') : '';
                    const localLogoPath = `img/logo/${logoFileName}.png`;

                    const tr = document.createElement('tr');
                    tr.dataset.status = 'checking';

                    tr.innerHTML = `
                        <td>${index}</td>
                        <td>${logoFileName}</td>
                        <td>${companyNameJa} (${companyNameEn})</td>
                        <td class="status-cell">確認中...</td>
                        <td class="logo-cell">
                            <img src="${localLogoPath}"
                                 onerror="this.parentElement.innerHTML='<span class=\\'status-missing\\'>画像なし</span>'; markMissing(this);"
                                 onload="markFound(this);"
                                 alt="${companyNameJa}">
                        </td>
                    `;

                    tbody.appendChild(tr);
                });

                document.getElementById('total-count').textContent = rows.length - 1;
            } catch (error) {
                console.error('Error loading CSV:', error);
            }
        }

        function parseCSV(text) {
            const rows = [];
            let currentRow = [];
            let currentCell = '';
            let inQuotes = false;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];

                if (inQuotes) {
                    if (char === '"' && nextChar === '"') {
                        currentCell += '"';
                        i++;
                    } else if (char === '"') {
                        inQuotes = false;
                    } else {
                        currentCell += char;
                    }
                } else {
                    if (char === '"') {
                        inQuotes = true;
                    } else if (char === ',') {
                        currentRow.push(currentCell);
                        currentCell = '';
                    } else if (char === '\n' || (char === '\r' && nextChar === '\n')) {
                        currentRow.push(currentCell);
                        rows.push(currentRow);
                        currentRow = [];
                        currentCell = '';
                        if (char === '\r') i++;
                    } else if (char !== '\r') {
                        currentCell += char;
                    }
                }
            }

            if (currentCell || currentRow.length > 0) {
                currentRow.push(currentCell);
                rows.push(currentRow);
            }

            return rows;
        }

        let foundCount = 0;
        let missingCount = 0;

        function markMissing(img) {
            const row = img.closest('tr');
            row.classList.add('missing');
            row.dataset.status = 'missing';
            row.querySelector('.status-cell').innerHTML = '<span class="status-missing">なし</span>';
            missingCount++;
            updateCounts();
        }

        function markFound(img) {
            const row = img.closest('tr');
            row.classList.add('found');
            row.dataset.status = 'found';
            row.querySelector('.status-cell').innerHTML = '<span class="status-ok">OK</span>';
            foundCount++;
            updateCounts();
        }

        function updateCounts() {
            document.getElementById('found-count').textContent = foundCount;
            document.getElementById('missing-count').textContent = missingCount;
        }

        function filterRows(filter) {
            document.querySelectorAll('#filter-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.querySelectorAll('#table-body tr').forEach(row => {
                const status = row.dataset.status;
                if (filter === 'all') {
                    row.style.display = '';
                } else if (filter === 'missing' && status === 'missing') {
                    row.style.display = '';
                } else if (filter === 'found' && status === 'found') {
                    row.style.display = '';
                } else if (filter !== 'all') {
                    row.style.display = 'none';
                }
            });
        }

        loadData();
    </script>
</body>
</html>
