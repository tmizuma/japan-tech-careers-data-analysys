---
description: 企業URLから情報を収集してCSVに追加するコマンド
allowed-tools: Bash(*), Read(*.csv), Write(*.csv), Fetch(*), web_search(*)
tools: Read, Write, Fetch, web_search
---

# タスク: 企業情報を CSV に追加

企業のウェブサイト URL を受け取り、そのサイトと検索エンジンから情報を収集して、`company_list.csv` に新しい行として追加します。

## 引数

- **第 1 引数（必須）**: 企業のウェブサイト URL
  - 例: `https://example.com`
  - 形式: http:// または https:// で始まる URL

## 前提条件

- `company_list.csv` ファイルが存在すること（存在しない場合は自動作成）
- インターネット接続が利用可能であること
- Web 検索が利用可能であること

## CSV ファイル形式

```csv
company_name_ja,company_name_en,description,description_en,hiring_url,num_of_employees,sales,foreign_engineers,logo_url,company_url
```

**各カラムの説明:**

- `company_name_ja`: 日本語社名（文字列）
- `company_name_en`: 英語社名（文字列）
- `description`: 企業説明・日本語（150 文字以上の文字列）
- `description_en`: 企業説明・英語（description の正確な翻訳）
- `hiring_url`: 採用ページ URL（文字列）
- `num_of_employees`: 従業員数（文字列、例: "2000+", "100-500", "50 未満"）
- `sales`: 売上（整数、億円単位、非公開の場合は -1）
- `foreign_engineers`: 外国人エンジニア採用（boolean、TRUE/FALSE）
- `logo_url`: ロゴ URL（文字列）
- `company_url`: 企業ウェブサイト URL（文字列）

## 実行手順

### ステップ 1: 引数のバリデーション

1. 第 1 引数（company_url）が指定されていることを確認
2. URL の形式が正しいことを確認（http:// または https:// で始まる）

**引数が指定されていない場合:**

```
使用方法: /add-company-to-csv [企業URL]

例:
  /add-company-to-csv https://about.mercari.com
  /add-company-to-csv https://example-startup.com

引数:
  企業URL (必須) - 企業のウェブサイトURL（会社概要ページやコーポレートサイトのトップページ）

保存先:
  company_list.csv（固定）
```

**URL の形式が不正な場合:**

```
❌ エラー: 有効なURLを指定してください。
指定されたURL: {url}
正しい形式: https://example.com
```

### ステップ 2: CSV ファイルの確認

`company_list.csv` の存在を確認します。

**ファイルが存在する場合:**

- ヘッダー行を読み込んで、必要なカラムが存在するか確認
- 既存のデータを保持

**ファイルが存在しない場合:**

- 新規 CSV ファイル `company_list.csv` を作成
- 以下のヘッダー行を設定:
  ```csv
  company_name_ja,company_name_en,description,description_en,hiring_url,num_of_employees,sales,foreign_engineers,logo_url,company_url
  ```

### ステップ 3: 企業ウェブサイトからの基本情報収集

web_fetch ツールを使用して、指定された URL のページを取得します。

**取得する情報:**

1. **company_name_ja（日本語社名）**

   - `<title>` タグから抽出
   - `<meta property="og:site_name">` から取得
   - ページ内の `<h1>` タグから推定
   - 会社概要ページの社名表記から取得

2. **company_name_en（英語社名）**

   - 日本語社名を英語表記に変換
   - URL のドメイン名から推定（例: mercari.com → Mercari）
   - 英語版ページが存在する場合はそちらから取得
   - 会社概要の英語表記から取得

3. **hiring_url（採用ページ URL）**

   - ページ内から以下のキーワードを含むリンクを探す:
     - 採用、キャリア、求人、Careers、Recruit、Jobs、採用情報
   - 見つからない場合は company_url と同じ値を設定

4. **logo_url（ロゴ URL）**
   - Clearbit Logo API を使用: `https://logo.clearbit.com/{domain}`
   - 例: `https://logo.clearbit.com/mercari.com`
   - ドメイン部分のみを抽出して使用

### ステップ 4: Web 検索による詳細情報収集

web_search ツールを使用して、企業の詳細情報を収集します。

**検索クエリの例:**

- `"{company_name_en}" 会社概要 事業内容 技術`
- `"{company_name_en}" 従業員数 社員数`
- `"{company_name_en}" 売上 revenue 億円`
- `"{company_name_en}" 外国人エンジニア グローバル採用 英語`

**取得する情報:**

1. **description（企業説明・日本語）**

   - Web 検索結果から企業の事業内容、技術的特徴、企業文化を収集
   - 以下の要素を含める:
     - 主要事業・プロダクト
     - 技術的な特徴や強み
     - 企業文化やバリュー
     - 事業展開（グローバル展開、新規事業など）
   - **最低 150 文字以上**の詳細な説明を作成
   - 具体的な技術スタック、サービス名、特徴を含める
   - 例: 「日本最大のフリマアプリ『メルカリ』を運営。マイクロサービスアーキテクチャを採用し、Go や Kubernetes を活用した大規模システム開発を実施。Fintech 領域への展開も積極的で、決済サービス『メルペイ』を提供。エンジニアリング組織は「Go Bold」の文化を掲げ、技術的挑戦を推奨。社内公用語は英語で、グローバルな開発体制を構築している。」

2. **description_en（企業説明・英語）**

   - description を正確に英語に翻訳
   - 翻訳には web 検索で得られた英語情報も活用
   - 専門用語や固有名詞は適切に英語表記に
   - 例: "Operates Mercari, Japan's largest flea market app. Adopts microservices architecture, implementing large-scale system development using Go and Kubernetes. Actively expanding into Fintech with payment service 'Merpay'. Engineering organization promotes technical challenges under 'Go Bold' culture. English is the official language, building a global development structure."

3. **num_of_employees（従業員数）**

   - 検索結果から従業員数を抽出
   - 形式: `2000+`, `100-500`, `50未満`, `Startup` など
   - 最新の情報を優先
   - 不明な場合は `Startup`（スタートアップの場合）または空文字列

4. **sales（売上）**

   - 検索結果から年間売上を抽出
   - **整数値（億円単位）**で記録
   - 例:
     - "1700 億円" → `1700`
     - "2 兆円" → `20000`
     - "300 億円" → `300`
     - "非公開" → `-1`
   - 最新の決算情報を優先
   - 情報が見つからない場合は `-1`

5. **foreign_engineers（外国人エンジニア採用）**
   - 以下のキーワードを検索結果から探す:
     - 英語公用語、グローバル採用、外国人エンジニア、多国籍チーム
     - 海外拠点、グローバル開発、英語環境
   - 採用ページに英語版が存在するかも確認
   - 判定結果:
     - 明確な証拠がある場合: `TRUE`
     - 証拠がない場合: `FALSE`
   - 不明な場合は `FALSE`（保守的に設定）

### ステップ 5: 収集した情報の確認と整形

収集した情報を以下の形式で表示し、ユーザーに確認を求めます。

```
📊 収集した企業情報:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
基本情報
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
日本語社名: メルカリ
英語社名: Mercari
企業URL: https://about.mercari.com/
採用URL: https://careers.mercari.com/
ロゴURL: https://logo.clearbit.com/mercari.com

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
企業説明（日本語）[152文字]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
日本最大のフリマアプリ『メルカリ』を運営。マイクロサービスアーキテクチャを採用し、GoやKubernetesを活用した大規模システム開発を実施。Fintech領域への展開も積極的で、決済サービス『メルペイ』を提供。エンジニアリング組織は「Go Bold」の文化を掲げ、技術的挑戦を推奨。社内公用語は英語で、グローバルな開発体制を構築している。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
企業説明（英語）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Operates Mercari, Japan's largest flea market app. Adopts microservices architecture, implementing large-scale system development using Go and Kubernetes. Actively expanding into Fintech with payment service 'Merpay'. Engineering organization promotes technical challenges under 'Go Bold' culture. English is the official language, building a global development structure.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
その他の情報
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
従業員数: 2000+
売上: 1700億円
外国人エンジニア: TRUE

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

この情報でCSVに追加してよろしいですか？ (y/n/e)
  y: 追加する
  n: キャンセル
  e: 編集する
```

**ユーザーの選択肢:**

- `y`: そのまま追加
- `n`: 処理を中止
- `e`: 情報を編集してから追加（ステップ 6 へ）

### ステップ 6: 情報の編集（オプション）

ユーザーが `e` を選択した場合、対話的に情報を編集します。

```
編集する項目を選択してください（番号を入力、複数選択可、カンマ区切り）:
1. 日本語社名
2. 英語社名
3. 企業説明（日本語）
4. 企業説明（英語）
5. 採用URL
6. 従業員数
7. 売上
8. 外国人エンジニア
9. 編集完了

選択:
```

選択された項目について、現在の値を表示して新しい値の入力を求めます。

**例（企業説明の編集）:**

```
現在の企業説明（日本語）[152文字]:
日本最大のフリマアプリ『メルカリ』を運営。マイクロサービスアーキテクチャを採用し...

新しい企業説明を入力してください（150文字以上、改行は削除されます）:
→ [ユーザー入力]

文字数: 158文字 ✓

現在の企業説明（英語）:
Operates Mercari, Japan's largest flea market app...

新しい企業説明（英語）を入力してください:
→ [ユーザー入力]
```

**売上の編集:**

```
現在の売上: 1700億円

新しい売上を入力してください（億円単位の数値、非公開の場合は -1）:
例: 1700, 300, -1
→ [ユーザー入力]
```

編集が完了したら、再度ステップ 5 の確認画面を表示します。

### ステップ 7: 重複チェック

CSV ファイル内に同じ企業が既に存在しないか確認します。

**チェック方法:**

- `company_url` が完全一致する行が存在するか
- `company_name_en` が一致する行が存在するか（大文字小文字を区別しない）

**重複が見つかった場合:**

```
⚠️ 警告: この企業は既にCSVに登録されています。

既存の情報:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
英語社名: Mercari
企業URL: https://about.mercari.com/
従業員数: 2000+
売上: 1700億円
登録日時: （CSVの行番号から推定）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

上書きしますか？ (y/n)
  y: 既存の行を更新
  n: 処理を中止
```

- `y` の場合: 既存の行を新しい情報で更新
- `n` の場合: 処理を中止

### ステップ 8: CSV への追加

収集した情報を CSV に追加します。

**追加する行の形式:**

```csv
{company_name_ja},{company_name_en},{description},{description_en},{hiring_url},{num_of_employees},{sales},{foreign_engineers},{logo_url},{company_url}
```

**データ型の処理:**

- `sales`: 整数値（例: 1700, -1）※ダブルクォート不要
- `foreign_engineers`: boolean 値（TRUE/FALSE）※ダブルクォート不要
- その他: 文字列（必要に応じてダブルクォートで囲む）

**CSV エスケープ処理:**

- フィールドにカンマが含まれる場合は、全体をダブルクォートで囲む
- ダブルクォート自体は `""` にエスケープ
- 改行コードは削除（description 内の改行も削除）
- 前後の空白をトリミング

**処理:**

1. `company_list.csv` を読み込み
2. 重複チェックの結果に応じて:
   - 新規追加: 末尾に新しい行を追加
   - 更新: 該当する行を新しい情報で置き換え
3. ファイルに書き込み

### ステップ 9: 完了メッセージの表示

```
✅ 企業情報をCSVに追加しました

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
追加された企業
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
英語社名: Mercari
企業URL: https://about.mercari.com/
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CSVファイル: company_list.csv
総企業数: 101社

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
次のステップ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
この企業の求人情報を収集するには、以下のコマンドを実行してください：

  /gather-japan-position-info company_list.csv --max-companies 1

全企業の求人情報を収集する場合：

  /gather-japan-position-info company_list.csv
```

## エラーハンドリング

### ウェブサイトへの接続失敗

```
❌ エラー: 企業ウェブサイトに接続できませんでした。

URL: {url}
エラー: {エラー内容}

対処方法:
- URLが正しいか確認してください
- ウェブサイトが一時的にダウンしている可能性があります
- 数分後に再試行してください
```

処理を中止します。

### Web 検索の失敗

```
⚠️ 警告: Web検索で一部の情報を取得できませんでした。

取得できた情報:
- 日本語社名: ✓
- 英語社名: ✓
- 企業説明: ✓（ウェブサイトから抽出）
- 採用URL: ✓

取得できなかった情報:
- 従業員数: 不明
- 売上: 不明

続行しますか？ (y/n/e)
  y: このまま続行（不明な項目はデフォルト値を使用）
  n: キャンセル
  e: 手動で入力
```

`e` を選択した場合、不足している情報を対話的に入力させます。

### description が 150 文字未満の場合

```
⚠️ 警告: 企業説明が150文字未満です。

現在の文字数: 98文字
最低文字数: 150文字

企業説明を追加・編集してください:
現在の内容:
{現在のdescription}

追記または書き直し（150文字以上）:
→ [ユーザー入力]
```

150 文字以上になるまで入力を求めます。

### CSV 書き込みエラー

```
❌ エラー: CSVファイルへの書き込みに失敗しました。

ファイル: company_list.csv
エラー: {エラー内容}

対処方法:
- ファイルの書き込み権限を確認してください
- ファイルが他のプログラムで開かれていないか確認してください
- ディスク容量を確認してください
```

処理を中止します。

## 実行例

### 正常実行（全自動）

```
ユーザー入力:
/add-company-to-csv https://about.mercari.com

処理:
🔍 企業ウェブサイトを取得中...
  → https://about.mercari.com
  → 基本情報を抽出中...

🌐 Web検索で詳細情報を収集中...
  → 企業概要を検索中...
  → 従業員数を検索中...
  → 売上情報を検索中...
  → グローバル採用情報を検索中...

📊 収集した企業情報:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
基本情報
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
日本語社名: メルカリ
英語社名: Mercari
企業URL: https://about.mercari.com/
採用URL: https://careers.mercari.com/
ロゴURL: https://logo.clearbit.com/mercari.com

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
企業説明（日本語）[152文字]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
日本最大のフリマアプリ『メルカリ』を運営。マイクロサービスアーキテクチャを採用し、GoやKubernetesを活用した大規模システム開発を実施。Fintech領域への展開も積極的で、決済サービス『メルペイ』を提供。エンジニアリング組織は「Go Bold」の文化を掲げ、技術的挑戦を推奨。社内公用語は英語で、グローバルな開発体制を構築している。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
企業説明（英語）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Operates Mercari, Japan's largest flea market app. Adopts microservices architecture, implementing large-scale system development using Go and Kubernetes. Actively expanding into Fintech with payment service 'Merpay'. Engineering organization promotes technical challenges under 'Go Bold' culture. English is the official language, building a global development structure.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
その他の情報
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
従業員数: 2000+
売上: 1700億円
外国人エンジニア: TRUE

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

この情報でCSVに追加してよろしいですか？ (y/n/e)
→ y

✅ 企業情報をCSVに追加しました

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
追加された企業
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
英語社名: Mercari
企業URL: https://about.mercari.com/
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CSVファイル: company_list.csv
総企業数: 101社
```

### 重複検出時

```
ユーザー入力:
/add-company-to-csv https://about.mercari.com

処理:
🔍 企業ウェブサイトを取得中...
🌐 Web検索で詳細情報を収集中...

⚠️ 警告: この企業は既にCSVに登録されています。

既存の情報:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
英語社名: Mercari
企業URL: https://about.mercari.com/
従業員数: 2000+
売上: 1700億円
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

上書きしますか？ (y/n)
→ n

❌ 処理を中止しました。
```

### 情報編集時

```
ユーザー入力:
/add-company-to-csv https://example-startup.com

処理:
🔍 企業ウェブサイトを取得中...
🌐 Web検索で詳細情報を収集中...

📊 収集した企業情報:
[情報表示]

この情報でCSVに追加してよろしいですか？ (y/n/e)
→ e

編集する項目を選択してください（番号を入力、複数選択可、カンマ区切り）:
1. 日本語社名
2. 英語社名
3. 企業説明（日本語）
4. 企業説明（英語）
5. 採用URL
6. 従業員数
7. 売上
8. 外国人エンジニア
9. 編集完了

選択: 3,4

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
企業説明（日本語）の編集
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
現在の文字数: 98文字
最低文字数: 150文字

新しい企業説明を入力してください（150文字以上）:
→ [ユーザー入力: 詳細な説明...]

文字数: 165文字 ✓

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
企業説明（英語）の編集
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
新しい企業説明（英語）を入力してください:
→ [ユーザー入力: English description...]

✓ 編集が完了しました

[再度確認画面を表示]

この情報でCSVに追加してよろしいですか？ (y/n/e)
→ y

✅ 企業情報をCSVに追加しました
```

## データ収集のガイドライン

### 従業員数の表記

- `50未満`: スタートアップ、創業期（従業員 1-49 人）
- `50-100`: 成長初期段階
- `100-500`: 中規模企業
- `500-1000`: 大規模企業
- `1000+`: 大企業（1000 人以上）
- `2000+`: メガ企業（2000 人以上）
- `5000+`: 超大企業（5000 人以上）
- `Startup`: 情報不明のスタートアップ

### 売上（億円単位の整数）

- 実際の売上額を億円単位で記録
- 例:
  - 1700 億円 → `1700`
  - 2 兆円 → `20000`（1 兆 = 10000 億円）
  - 300 億円 → `300`
  - 50 億円 → `50`
  - 非公開・不明 → `-1`
- 最新の決算情報を優先
- 連結売上と単体売上がある場合は連結を優先

### 外国人エンジニア採用の判定

以下のいずれかに該当する場合は `TRUE`:

- 社内公用語が英語またはバイリンガル
- 採用ページに英語版が存在し、積極的に採用している
- 「グローバル採用」「多国籍チーム」を明示
- 外国人比率が公開されている（特にエンジニア）
- 海外拠点が存在し、そこでエンジニア採用を行っている
- ビザサポートを明示している

該当しない、または不明な場合は `FALSE`

### 企業説明（description）の作成ガイドライン

**最低 150 文字以上**で、以下の要素を含める:

1. **主要事業・プロダクト**（必須）

   - 具体的なサービス名やプロダクト名
   - 事業規模や市場ポジション

2. **技術的特徴**（推奨）

   - 使用している技術スタック
   - アーキテクチャの特徴
   - 技術的な挑戦や強み

3. **事業展開**（推奨）

   - 新規事業や将来展開
   - グローバル展開の状況
   - 成長戦略

4. **企業文化・組織**（あれば）
   - エンジニアリング文化
   - 働き方の特徴
   - 組織の価値観

**良い例（152 文字）:**

```
日本最大のフリマアプリ『メルカリ』を運営。マイクロサービスアーキテクチャを採用し、GoやKubernetesを活用した大規模システム開発を実施。Fintech領域への展開も積極的で、決済サービス『メルペイ』を提供。エンジニアリング組織は「Go Bold」の文化を掲げ、技術的挑戦を推奨。社内公用語は英語で、グローバルな開発体制を構築している。
```

**悪い例（短すぎる・具体性に欠ける）:**

```
フリマアプリを運営する企業。技術力が高く、グローバル展開している。
```

### 企業説明（description_en）の翻訳ガイドライン

- description を**正確に**英語に翻訳
- 直訳ではなく、英語として自然な表現に
- 専門用語や技術用語は適切な英語表記に
- 固有名詞（サービス名など）はそのまま保持
- 文字数の制約はないが、description と同等の情報量を保つ

## 注意事項

1. **データの正確性**: 自動収集した情報は必ず確認してから追加
2. **重複チェック**: 既存データとの重複を避ける
3. **個人情報**: 企業の公開情報のみを収集する
4. **著作権**: 企業説明は自分の言葉で要約・記述する
5. **文字数**: description は必ず 150 文字以上
6. **データ型**: sales は整数値、foreign_engineers は boolean
7. **コミットしない**: このコマンドはコミットを行わない
8. **固定ファイル名**: 保存先は常に `company_list.csv`

## 実行開始

コマンドとして呼び出された際、上記の手順に従って企業情報を収集し、`company_list.csv` に追加してください。
